{% extends 'base.html' %}
{% load staticfiles %}
{% block title%}{% endblock %}
{% block body_content%}
<div class="container-full">
    <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
            <a class="nav-link active" id="faculty_summary-tab" data-toggle="tab" href="#faculty_summary" role="tab" aria-controls="faculty_summary" aria-selected="true">Faculty summary</a>
        </li>
        <li>
            <a class="nav-link" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-selected="true">Details</a>
        </li>
        <li>
            <a class="nav-link" id="figures-tab" data-toggle="tab" href="#figures" role="tab" aria-controls="figures" aria-selected="true">Figures</a>
        </li>
    </ul>
    <div class="tab-content p-3">
        <div class="tab-pane fade show active" id="faculty_summary" role="tabpanel" aria-labelledby="faculty_summary-tab">
            <div id="vizContainer_faculty_summary"></div>
        </div>
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
            <div id="vizContainer_details"></div>
        </div>
        <div class="tab-pane fade" id="figures" role="tabpanel" aria-labelledby="figures-tab">
            <div id="vizContainer_figures"></div>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts_end_of_page_content %}
<script type="text/javascript" src="{% static 'dashboard/js/tableau-2.min.js' %}"></script>

<script type="text/javascript">
function initVizContainer_faculty_summary() {
    // Calculates the width of the parent container so the vizualization takes the full width of the screen
    // the minus 40 pixels is here to take into account the margins and padding to the parent tab
    var containerSize = $("#vizContainer_faculty_summary").parents('div.container-full')[0].clientWidth - 40;

    var vizContainer_faculty_summary_containerDiv = document.getElementById("vizContainer_faculty_summary"),
    url = "https://tableau.epfl.ch/views/teaching/personal_faculty_summary",
    options = {
        hideTabs: true,
        hideToolbar: true,
        width: containerSize + 'px',
        height: '2000px',
    }

    viz_container_summary = new tableau.Viz(vizContainer_faculty_summary_containerDiv, url, options);
}


function initVizContainer_details() {
    // Calculates the width of the parent container so the vizualization takes the full width of the screen
    // the minus 40 pixels is here to take into account the margins and padding to the parent tab
    var containerSize = $("#vizContainer_details").parents('div.container-full')[0].clientWidth - 40;

    var vizContainer_details_containerDiv = document.getElementById("vizContainer_details"),
    url = "https://tableau.epfl.ch/views/teaching/personal_details",
    options = {
        hideTabs: true,
        hideToolbar: true,
        width: containerSize + 'px',
        height: '3000px',
        'Institute': '{{ institute }}',
        onFirstInteractive: function() {
            viz_container_details_worksheets = viz_container_details.getWorkbook().getActiveSheet().getWorksheets();

            // Only highlight the person on the first worksheet.
            // The coordination across all worksheets is taken care of by a custom action on Tableau
            viz_container_details_worksheets[0].selectMarksAsync('Sciper', '{{ sciper }}', tableau.SelectionUpdateType.REPLACE);
            },
        };
    viz_container_details = new tableau.Viz(vizContainer_details_containerDiv, url, options);

    viz_container_details.addEventListener(tableau.TableauEventName.FILTER_CHANGE, function(filter){
        console.log('re-highlighting the details dashboard because the filters have changed.');
        viz_container_details_worksheets[0].selectMarksAsync('Sciper', '{{ sciper }}', tableau.SelectionUpdateType.REPLACE);
    });
}

function initVizContainer_figures() {
    // Calculates the width of the parent container so the vizualization takes the full width of the screen
    // the minus 40 pixels is here to take into account the margins and padding to the parent tab
    var containerSize = $("#vizContainer_figures").parents('div.container-full')[0].clientWidth - 40;

    var vizContainer_figures_containerDiv = document.getElementById("vizContainer_figures"),
    url = "https://tableau.epfl.ch/views/teaching/personal_figures",
    options = {
        hideTabs: true,
        hideToolbar: true,
        width: containerSize + 'px',
        height: '2000px',
        'Sciper': '{{ sciper }}',
        };
    viz_container_figures = new tableau.Viz(vizContainer_figures_containerDiv, url, options);
}

$(document).ready(function(){
    initVizContainer_faculty_summary();
    initVizContainer_details();
    initVizContainer_figures();
})

</script>

{% endblock%}
